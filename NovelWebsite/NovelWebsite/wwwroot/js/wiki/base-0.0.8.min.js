var actions = {};
$("body").on("click", "[data-action]", function (a) {
    var b = $(this).data("action");
    if (b in actions) {
        actions[b]($(this), a)
    }
});
var touchs = {};
$("body").on("click tap touchstart touchend touchmove", "[data-touch]", function (a) {
    var b = $(this).data("touch");
    if (b in touchs) {
        touchs[b]($(this), a)
    }
});

function popupCenter(a, i, j, e) {
    var g = window.screenLeft != undefined ? window.screenLeft : screen.left;
    var b = window.screenTop != undefined ? window.screenTop : screen.top;
    var c = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;
    var k = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;
    var d = ((c / 2) - (j / 2)) + g;
    var f = ((k / 2) - (e / 2)) + b;
    return window.open(a, i, "scrollbars=yes, width=" + j + ", height=" + e + ", top=" + f + ", left=" + d)
}
actions.login = function (e, c) {
    Object.keys(Cookies.get()).forEach(function (f) {
        Cookies.remove(f);
        Cookies.remove(f, {
            path: "/",
            domain: "wikidich.com"
        });
        Cookies.remove(f, {
            path: "/",
            domain: ".wikidich.com"
        })
    });
    var b = "/auth/dth";
    var a = popupCenter(b, "Login", 600, 530);
    var d = setInterval(function () {
        if (a.closed) {
            clearInterval(d);
            location.reload()
        }
    }, 500)
};
actions.logout = function (c, b) {
    var a = "/logout";
    $.ajax({
        type: "POST",
        url: a,
        success: function (d) {
            if (d.err == ApiError.SUCCESS) {
                Cookies.remove("express.sid");
                location.reload()
            } else {
                Materialize.toast("Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh. Vui lÃ²ng thá»­ láº¡i sau!", 2000)
            }
        },
        error: function (f, d, e) {
            Materialize.toast("Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh. Vui lÃ²ng thá»­ láº¡i sau!", 2000)
        }
    })
};

function updateBookStats(f, d, c, e, b) {
    var a = "/book/stats";
    if (c === 1) {
        a = "/book/stats/view"
    } else {
        if (c === 2) {
            a = "/book/stats/like"
        } else {
            if (c === 3) {
                a = "/book/stats/thank"
            }
        }
    }
    $.ajax({
        type: "POST",
        url: a,
        data: {
            bookId: f,
            chapterId: d,
            type: c,
            value: e
        },
        success: function (g) {
            if (g.err == ApiError.SUCCESS) {
                if (b) {
                    b(true, g)
                }
            } else {
                if (b) {
                    b(false, g)
                }
            }
        },
        error: function (i, g, h) {
            if (b) {
                b(false)
            }
        }
    })
}
actions.loadPage = function (b, a) {
    if (b.attr("href") && window.location.href != b.attr("href")) {
        window.location.href = b.attr("href")
    }
};
actions.redirect = function (b, a) {
    window.location.href = b.data("href")
};
var readys = {};
$(document).ready(function () {
    $("[data-ready]").each(function () {
        var a = $(this).data("ready");
        if (a in readys) {
            readys[a]($(this))
        }
    })
});

function abbreviateNumber(e) {
    var g = parseInt(e);
    if (e >= 1000) {
        var b = ["", "k", "m", "b", "t"];
        var d = Math.floor(("" + e).length / 3);
        var c = "";
        for (var a = 2; a >= 1; a--) {
            c = parseFloat((d != 0 ? (e / Math.pow(1000, d)) : e).toPrecision(a));
            var f = (c + "").replace(/[^a-zA-Z 0-9]+/g, "");
            if (f.length <= 2) {
                break
            }
        }
        if (c % 1 != 0) {
            shortNum = c.toFixed(1)
        }
        g = c + b[d]
    }
    return g
}
readys.abbrNum = function (b, a) {
    b.text(abbreviateNumber(b.text()))
};